(()=>{"use strict";const e=JSON.parse('{"Rm":"AIzaSyCIVwy-EeQTsEF8GrxfACvBVDAcsQwE3aI","cS":["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],"Ro":"392633700892-bham3toa4uf309t8jit739t8ut4t9pc9.apps.googleusercontent.com","k0":["https://www.googleapis.com/auth/calendar"]}'),t=new Promise((function(t){gapi.load("client",(async function(){await gapi.client.init({apiKey:e.Rm,discoveryDocs:e.cS}),t()}))}));let n;const i=google.accounts.oauth2.initTokenClient({client_id:e.Ro,scope:e.k0.join(" "),callback:e=>n(e)});function a(e){document.querySelectorAll("#message div").forEach((function(e){e.setAttribute("hidden","")})),document.getElementById(e).removeAttribute("hidden")}const r=JSON.parse('{"storage-keys":{"assignments-data":""},"calendar-name":"manabaの課題"}'),o=[r];for(;o.length>0;){const e=o.pop();for(const t in e){const n=e[t];"string"==typeof n?""===n&&(e[t]=t):o.push(n)}}const s=r;let c=null;document.querySelector("#register button")?.addEventListener("click",(async function(e){if(await async function(){if(null===c){await t;const e=await async function(){return new Promise((function(e){n=e,null===gapi.client.getToken()?i.requestAccessToken({prompt:"consent"}):i.requestAccessToken({prompt:""})}))}();if("error"in e){const t=[e.error,e.error_description,e.error_uri].join("\n");return alert(t),!0}if(a("initializing"),c=await async function(){const e=(await gapi.client.calendar.calendarList.list()).result.items;if(void 0!==e)for(const t of e)if(t.summary===s["calendar-name"])return void 0===t.id?null:t.id;return null}(),null===c)return c=await async function(){const e=Intl.DateTimeFormat().resolvedOptions().timeZone,t=(await gapi.client.calendar.calendars.insert({},{summary:s["calendar-name"],timeZone:e})).result.id;return void 0===t?null:t}(),a(null===c?"initialization-failed":"created"),!0;a("initialized")}return!1}())return;const r=e.target;if(!("assignments"in r))return;a("registering");const o=r.assignments.map((async function(e){const t=await async function(e){if(null===c)return null;if(null===e.deadline)return null;const t=`${e.title} | ${e.course}`,n=e.url,i=e.deadline,a=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours()-1),r=Intl.DateTimeFormat().resolvedOptions().timeZone;return(await gapi.client.calendar.events.insert({calendarId:c,resource:{summary:t,description:n,start:{dateTime:a.toISOString(),timeZone:r},end:{dateTime:i.toISOString(),timeZone:r}}})).result}(e);return{assignment:e,event:t}})),l=await Promise.all(o),u=[];for(const{assignment:e,event:t}of l)null!==t&&u.push(e);const d=document.querySelector("#register .callback");Object.defineProperty(d,"assignments",{value:u}),d.dispatchEvent(new Event("click")),a("registered")}))})();