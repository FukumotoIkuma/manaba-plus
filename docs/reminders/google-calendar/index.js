(()=>{"use strict";const e=JSON.parse('{"title":"Manaba Plus オプション","common":{"title":"一般","root-url":{"hint":"manabaのURL","description":"manabaのルートのURLです。ホーム画面にアクセスしたときに自動的に設定されますが、ここで変更することもできます。","type":"text","value":""},"allow-changing":{"hint":"変更を許可する","description":"チェックを入れると、Manaba Plusに画面の変更を許可することになります。画面の読み込みが遅いと感じたら、チェックを外してください。","type":"checkbox","value":true},"show-notes":{"hint":"「メモ」を表示する","description":"チェックを入れると、ホーム画面の上部やその他の画面の下部にある「メモ」を表示します。","type":"checkbox","value":true,"dependency":"allow-changing"},"transition-directly":{"hint":"リンクを直接開く","description":"チェックを入れると、外部リンクをクリックしたとき、確認ダイアログを表示せずにリンクを開きます。","type":"checkbox","value":true,"dependency":"allow-changing"}},"main-panel":{"title":"メインパネル","messages":{"title":"メッセージ","show-messages":{"hint":"メッセージを表示する","description":"チェックを入れると、メインパネルにメッセージが表示されます。","type":"checkbox","value":true},"notify-timeout":{"hint":"タイムアウトを通知する","description":"チェックを入れると、タイムアウト画面から自動的にホーム画面に戻ったときに通知されます。","type":"checkbox","value":true,"dependency":"show-messages"},"notify-version":{"hint":"アップデートを通知する","description":"チェックを入れると、Manaba Plusがバージョンアップしたときに通知されます","type":"checkbox","value":true,"dependency":"show-messages"},"download-interval":{"hint":"ダウンロード通知日数","description":"最後にコンテンツをダウンロードしてからこの日数が経過すると通知されます。空欄にすると通知されません。","type":"number","value":7,"min":1,"dependency":"show-messages"}},"show-assignment-list-open":{"hint":"未提出課題一覧を開く","description":"チェックを入れると、メインパネルを開いたとき、未提出課題一覧が開いた状態で表示されます。","type":"checkbox","value":false},"removed-assignments":{"hint":"除外された未提出課題","description":"未提出課題一覧から除外された課題は$length$個です。","type":"collection","value":[]}},"home":{"title":"ホーム画面","dependency":"allow-changing","show-home-panel":{"hint":"メインパネルを表示する","description":"チェックを入れると、ホーム画面にManaba Plusのメインパネルが表示されます。チェックが入っていないときにメインパネルを表示するには、拡張機能アイコンをクリックします。","type":"checkbox","value":true},"starred-courses":{"hint":"⭐がついたコース","description":"ホーム画面の⭐がついたコースは$length$個です。","type":"collection","value":[]},"removed-courses":{"hint":"除外されたコース","description":"ホーム画面から除外されたコースは$length$個です。","type":"collection","value":[]},"visibility-and-movement":{"title":"表示と移動","hide-or-move-alert":{"hint":"アラート","description":"ホーム画面の「ポートフォリオにコレクションが追加されました。」「コレクションが更新されています。」「ポートフォリオのコレクションにコメントが追加されました。」などのアラートの表示方法を選んでください。","type":"radio","value":"hide","choices":[{"key":"ignore","hint":"上部に表示する","description":"選択すると、ホーム画面の上部に表示されます。"},{"key":"move","hint":"下部に表示する","description":"選択すると、ホーム画面の下部に表示されます。"},{"key":"hide","hint":"表示しない","description":"選択すると、表示されません。"}],"id":"alert"},"hide-or-move-centernews":{"hint":"「お知らせ」","description":"ホーム画面のメンテナンス情報などのお知らせの表示方法を選んでください。","type":"radio","value":"move","choices":[{"key":"ignore","hint":"上部に表示する","description":"選択すると、ホーム画面の上部に表示されます。"},{"key":"move","hint":"下部に表示する","description":"選択すると、ホーム画面の下部に表示されます。"},{"key":"hide","hint":"表示しない","description":"選択すると、表示されません。"}],"id":"news"},"hide-or-move-syllabus":{"hint":"「シラバス検索」","description":"ホーム画面のシラバス検索ボックスの表示方法を選んでください。","type":"radio","value":"move","choices":[{"key":"ignore","hint":"右側に表示する","description":"選択すると、ホーム画面の右側に表示されます。"},{"key":"move","hint":"下部に表示する","description":"選択すると、ホーム画面の下部に表示されます。"},{"key":"hide","hint":"表示しない","description":"選択すると、表示されません。"}],"id":"syllabus"},"hide-or-move-assignment":{"hint":"「課題」","description":"ホーム画面の本家の未提出課題一覧と課題提出記録の表示方法を選んでください。","type":"radio","value":"hide","choices":[{"key":"ignore","hint":"右側に表示する","description":"選択すると、ホーム画面の右側に表示されます。"},{"key":"move","hint":"下部に表示する","description":"選択すると、ホーム画面の下部に表示されます。"},{"key":"hide","hint":"表示しない","description":"選択すると、表示されません。"}],"id":"assignment"},"hide-or-move-self-registration":{"hint":"「自己登録について」","description":"ホーム画面の「自己登録について」の表示方法を選んでください。","type":"radio","value":"ignore","choices":[{"key":"ignore","hint":"右側に表示する","description":"選択すると、ホーム画面の右側に表示されます。"},{"key":"move","hint":"下部に表示する","description":"選択すると、ホーム画面の下部に表示されます。"},{"key":"hide","hint":"表示しない","description":"選択すると、表示されません。"}],"id":"self-registration"},"hide-or-move-former-link":{"hint":"「旧スマートフォン版について」","description":"ホーム画面の旧スマートフォン版へのリンクの表示方法を選んでください。","type":"radio","value":"hide","choices":[{"key":"ignore","hint":"右側に表示する","description":"選択すると、ホーム画面の右側に表示されます。"},{"key":"move","hint":"下部に表示する","description":"選択すると、ホーム画面の下部に表示されます。"},{"key":"hide","hint":"表示しない","description":"選択すると、表示されません。"}],"id":"former-link"},"hide-or-move-kikuzou":{"hint":"朝日新聞の広告","description":"ホーム画面の朝日新聞の広告の表示方法を選んでください。","type":"radio","value":"move","choices":[{"key":"ignore","hint":"右側に表示する","description":"選択すると、ホーム画面の右側に表示されます。"},{"key":"move","hint":"下部に表示する","description":"選択すると、ホーム画面の下部に表示されます。"},{"key":"hide","hint":"表示しない","description":"選択すると、表示されません。"}],"id":"kikuzou"},"hide-or-move-banner-list":{"hint":"バナー","description":"ホーム画面のバナーの表示方法を選んでください。","type":"radio","value":"move","choices":[{"key":"ignore","hint":"右側に表示する","description":"選択すると、ホーム画面の右側に表示されます。"},{"key":"move","hint":"下部に表示する","description":"選択すると、ホーム画面の下部に表示されます。"},{"key":"hide","hint":"表示しない","description":"選択すると、表示されません。"}],"id":"banner-list"}}},"contents":{"title":"コンテンツ","directory-name":{"hint":"ダウンロード先","description":"ダウンロードされたコンテンツが保存されるフォルダの名前です。空白にすると既定のダウンロードフォルダに直接保存されます。","type":"text","value":"manaba"},"download-limit":{"hint":"同時ダウンロード数","description":"同時にダウンロードされるコンテンツ数の上限値です。ブラウザの制限により、この数で同時にダウンロードできないことがあります。","type":"number","value":5,"min":1},"contents-limit":{"title":"コンテンツの制限","download-only-starred":{"hint":"⭐がついたコースのみダウンロードする","description":"チェックを入れると、⭐がついたコースのコンテンツのみをダウンロードします。チェックを外すと⭐がついていないコースのコンテンツもダウンロードされます。","type":"checkbox","value":false},"download-removed":{"hint":"除外されているコースをダウンロードする","description":"チェックを入れると、除外されているコースのコンテンツもダウンロードします。チェックを外すと除外されているコースのコンテンツはダウンロードされません。","type":"checkbox","value":false},"download-news":{"hint":"コースニュースをダウンロードする","description":"チェックを入れると、コースニュースにあるコンテンツをダウンロードします。","type":"checkbox","value":true},"download-report":{"hint":"レポートをダウンロードする","description":"チェックを入れると、レポートにあるコンテンツをダウンロードします。","type":"checkbox","value":true},"download-course-contents":{"hint":"コースコンテンツをダウンロードする","description":"チェックを入れると、コースコンテンツにあるコンテンツをダウンロードします。","type":"checkbox","value":true},"download-report-assignments":{"hint":"提出物をダウンロードする","description":"チェックを入れると、レポートの相互閲覧画面にある提出物をダウンロードします。","type":"checkbox","value":false}},"delete-history":{"hint":"","description":"コンテンツの重複ダウンロードを防ぐために内部に保存している履歴を消去します。","type":"button","value":"ダウンロード履歴のリセット"}},"reminders":{"title":"リマインダー","google-calendar":{"title":"Googleカレンダー","registered-assignments-gc":{"hint":"登録された課題","description":"Googleカレンダーに登録された課題は$length$個です。","type":"collection","value":[]}}},"timeout":{"title":"タイムアウト画面","destination-on-timeout":{"hint":"リンク先","description":"タイムアウト画面からリンクするページのURLです。空欄の場合はホーム画面にリンクします。","type":"text","value":""},"transition-automatically":{"hint":"自動的に移動する","description":"チェックを入れると、タイムアウト画面から自動的にリンク先へ移動します。","type":"checkbox","value":true},"timeout-button-label":{"hint":"ボタンのラベル","description":"タイムアウト画面に追加されるボタンのラベルです。","type":"text","value":"manabaのホーム画面に移動する","dependency":"!transition-automatically"}},"other":{"title":"その他","reset-options":{"hint":"","description":"設定を初期値に戻します。","type":"button","value":"設定のリセット"}}}'),t=new Map,n=new Map;let i=!1;const o=async function(){t.set("",e);const o=[e];for(;o.length>0;){const e=o.pop();e.isSection=!0,Object.defineProperty(e,"children",{get(){let t=1;return void 0!==e.dependency&&t++,Object.keys(e).slice(t,-1).map((function(t){return{key:t,node:e[t]}}))}});for(const{key:i,node:s}of e.children)if("title"in s){const e=s;o.push(e),t.set(i,e)}else{s.isSection=!1;const e=s;"value"in e&&(e._value=e.value),n.set(i,e)}}const s=await chrome.storage.sync.get([...n.keys()]);for(const e in s)n.get(e)._value=s[e];for(const[e,t]of n)Object.defineProperty(t,"value",{get:()=>t._value,set(n){null!==n?t._value!==n&&(t._value=n,chrome.storage.sync.set({[e]:n})):chrome.storage.sync.remove(e)}});i=!0};async function s(){return i||await o(),{options:e,sections:t,items:n}}const r=new DOMParser,a=async function(e,t){const n=await async function(e,t){const n=await fetch(e,t);return await n.text()}(e,t),i=r.parseFromString(n,"text/html"),o=i.createElement("base");return o.href=e,i.head.appendChild(o),i},c=new TextEncoder;class l{constructor(e,t,n,i=null){this.url=e,this.title=t,this.course=n,this.deadline=i,this._isShown=!0,this.onIsShownChanged=[],this.hash=async function(e){const t=c.encode(e),n=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(n);return Array.from(i).map((e=>e.toString(16).padStart(2,"0"))).join("")}(e)}get isShown(){return this._isShown}set isShown(e){if(this._isShown!==e){this._isShown=e;for(const t of this.onIsShownChanged)t(e)}}}const d=/(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2})/,u=function(e){const t=d.exec(e);if(null===t)return null;{const[e,n,i,o,s]=t.slice(1).map((e=>parseInt(e)));return new Date(e,n-1,i,o,s)}},h=function*(e){const t=e.querySelectorAll("table.stdlist tr:not(.title)");for(const e of Array.from(t)){const t=e.children;if(t.length<3)return;const n=t[0].querySelector("a")?.href;if(void 0===n)continue;const i=Array.from(t).map((e=>e.textContent.trim()));yield new l(n,i[0],i[1],u(i[2]))}},p=JSON.parse('{"Rm":"AIzaSyCIVwy-EeQTsEF8GrxfACvBVDAcsQwE3aI","cS":["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],"Ro":"392633700892-bham3toa4uf309t8jit739t8ut4t9pc9.apps.googleusercontent.com","k0":["https://www.googleapis.com/auth/calendar"]}'),m=new Promise((function(e){gapi.load("client",(async function(){await gapi.client.init({apiKey:p.Rm,discoveryDocs:p.cS}),e()}))}));let y;const g=google.accounts.oauth2.initTokenClient({client_id:p.Ro,scope:p.k0.join(" "),callback:e=>y(e)});function v(e){document.querySelectorAll("#message div").forEach((function(e){e.setAttribute("hidden","")})),document.getElementById(e).removeAttribute("hidden")}const f=JSON.parse('{"calendar-name":"manabaの課題"}'),w=[f];for(;w.length>0;){const e=w.pop();for(const t in e){const n=e[t];"string"==typeof n?""===n&&(e[t]=t):w.push(n)}}const k=f;let b=null;const S=async function(e){if(null===b)return null;if(null===e.deadline)return null;const t=`${e.title} | ${e.course}`,n=e.url,i=e.deadline,o=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours()-1),s=Intl.DateTimeFormat().resolvedOptions().timeZone;return(await gapi.client.calendar.events.insert({calendarId:b,resource:{summary:t,description:n,start:{dateTime:o.toISOString(),timeZone:s},end:{dateTime:i.toISOString(),timeZone:s}}})).result};document.querySelector("#register button")?.addEventListener("click",(async function(){if(null===b){if(await async function(){await m;const e=await async function(){return new Promise((function(e){y=e,null===gapi.client.getToken()?g.requestAccessToken({prompt:"consent"}):g.requestAccessToken({prompt:""})}))}();if("error"in e){const t=[e.error,e.error_description,e.error_uri].join("\n");alert(t)}}(),v("initializing"),b=await async function(){const e=(await gapi.client.calendar.calendarList.list()).result.items;if(void 0!==e)for(const t of e)if(t.summary===k["calendar-name"])return void 0===t.id?null:t.id;return null}(),null===b)return b=await async function(){const e=Intl.DateTimeFormat().resolvedOptions().timeZone,t=(await gapi.client.calendar.calendars.insert({},{summary:k["calendar-name"],timeZone:e})).result.id;return void 0===t?null:t}(),void v(null===b?"initialization-failed":"created");v("initialized")}v("registering");const{options:e}=await s(),t=new Set,n=new Set(e.reminders["google-calendar"]["registered-assignments-gc"].value);for await(const e of async function*(){const{options:e}=await s(),t=new Set,n=new Set(e["main-panel"]["removed-assignments"].value);for await(const i of async function*(){const{options:e}=await s(),t=e.common["root-url"].value,n=[t+"home_summary_query",t+"home_summary_survey",t+"home_summary_report"];for(const e of n){const t=await a(e);yield*h(t)}}()){const o=await i.hash;t.add(o),i.isShown=!n.has(o),i.onIsShownChanged.push((function(t){t?n.delete(o):n.add(o),e["main-panel"]["removed-assignments"].value=Array.from(n)})),yield i}for(const e of n)t.has(e)||n.delete(e);e["main-panel"]["removed-assignments"].value=Array.from(n)}()){const i=await e.hash;t.add(i),n.has(i)||S(e)}for(const e of n)t.has(e)||n.delete(e);e.reminders["google-calendar"]["registered-assignments-gc"].value=Array.from(n),v("registered")}))})();